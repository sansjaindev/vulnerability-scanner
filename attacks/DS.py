import subprocess
import json
import os

def run_dirsearch(url):
	command = f"dirsearch -u {url} -o output.json --format=json"

	try:
		subprocess.check_output(command, shell=True, stderr=subprocess.STDOUT)
	except subprocess.CalledProcessError as e:
		print(f"Error running dirsearch: {e}")
		return
	
	with open('output.json', "r") as file:
		results = json.load(file)

	os.remove('output.json')
	os.rmdir('reports')

	response = results['results']
	res = []

	for item in response:
		if item['redirect'] != '':
			res.append([item['status'], item['url'] + ' -> ' + item['redirect']])
		else:
			res.append([item['status'], item['url']])
	
	return res